# 훈련 상태 보고서

**마지막 업데이트**: 2025-10-07 03:56 KST

## 🎯 현재 훈련 세션

**프로세스 ID**: e2a4f5
**스크립트**: train_conservative.py
**진행률**: 320,000 / 5,000,000 타임스텝 (6.4%)
**예상 완료**: 약 6시간 후

---

## 📊 데이터 규모

| 항목 | 값 |
|------|-----|
| 원본 캔들 | 17,280개 |
| 기간 | 60일 (2025-08-07 ~ 2025-10-06) |
| 처리 후 | 17,235개 |
| 훈련 데이터 | 12,064개 (70%) |
| 검증 데이터 | 2,585개 (15%) |
| 테스트 데이터 | 2,586개 (15%) |

---

## ⚙️ 보수적 설정 (현재)

| 파라미터 | 기존 | 현재 | 변화 |
|---------|------|------|------|
| **레버리지** | 10배 | **3배** | ⬇️ 안정성 증가 |
| **포지션 크기** | 0.1 BTC | **0.03 BTC** | ⬇️ 리스크 감소 |
| **손절** | 2% | **1%** | ⬇️ 빠른 손절 |
| **익절** | 4% | **2%** | ⬇️ 현실적 목표 |

---

## 📈 검증 세트 성능 (최신 320k)

### 학습 추이

| 타임스텝 | Mean Reward | 예상 수익률 | 비고 |
|---------|-------------|-------------|------|
| 10k | +15.27 | +0.15% | 초기 |
| 20k | +37.91 | +0.38% | +148% 개선 |
| 30k | +51.54 | +0.52% | +36% 개선 |
| **80k** | **+58.87** | **+0.59%** | 🚀 최고점 도달 |
| 90k-320k | +58.87 | +0.59% | ✅ 안정 유지 |

**핵심 발견**:
- ✅ **80k 타임스텝에서 최적 성능 도달**
- ✅ **이후 240k 동안 성능 안정 유지**
- ✅ **과도한 파산 없음** (보수적 설정 효과)

### 보상 → 수익률 변환

```
Reward = Portfolio Return × 10,000

Mean Reward +58.87
= 0.5887% 포트폴리오 수익률
```

---

## 📉 훈련 에피소드 성능

**평균 보상**: -3,540 (-35.4% 손실)

**문제점**:
- 훈련 데이터에서 여전히 손실
- 검증 vs 훈련 차이: ~3,600 포인트
- **과적합(Overfitting) 우려**

---

## 🔄 훈련 버전 히스토리

### V1 (원본, 1000 캔들)
- 데이터: 1,000 캔들 (3.47일)
- 환경: 기본 (증거금 버그 있음)
- 레버리지: 10배
- **결과**: -0.02% (거의 학습 안됨)

### V2 (버그 수정, 3997 캔들)
- 데이터: 3,997 캔들 (13.88일)
- 환경: 버그 수정 (증거금 계산 오류 등 5개 수정)
- 레버리지: 10배
- **결과**: -0.57% (개선됨, 하지만 여전히 손실)

### V3 (순수 수익률 보상, 3997 캔들)
- 데이터: 3,997 캔들
- 환경: 순수 PnL 보상 (보너스 제거)
- 레버리지: 10배
- **결과**: -0.31% (추가 개선)

### Conservative (보수적, 17280 캔들) ⭐ **현재**
- 데이터: **17,280 캔들 (60일)** - 4.3배 증가
- 환경: V3 (순수 PnL)
- 레버리지: **3배** (보수적)
- 포지션: **0.03 BTC** (보수적)
- **검증 결과**: **+0.59% (현재 최고!)**
- **진행 중**: 320k / 5M (6.4%)

---

## 🔍 발견한 주요 버그

### 1. 증거금 계산 오류 ⚠️ 치명적
```python
# 기존 (WRONG)
required_margin = position × price  # 레버리지 미적용
# 0.1 BTC × $50,000 = $5,000 필요

# 수정 (CORRECT)
required_margin = position × price / leverage
# 0.1 BTC × $50,000 / 10 = $500 필요

→ 10배 더 많은 증거금 요구로 거래 불가
```

### 2. 파산 페널티 과도
```python
# 기존: -100 × 100 (스케일링) = -10,000
# 수정: -10 (스케일링 제거)
```

### 3. 보상 이중 증폭
```python
# 기존: return × 100 × 100 = 10,000배
# 수정: return × 10,000 = 10,000배 (단일)
```

### 4. 스텝 실행 순서
```python
# 기존: 손절/익절이 보상 계산 전 실행 → 왜곡
# 수정: 거래 → 스텝 이동 → 손절/익절 체크
```

### 5. 보상 함수 설계
```python
# 기존: 복잡한 보너스/페널티 시스템
# 수정: 순수 포트폴리오 수익률만 사용
```

---

## 📝 다음 단계

### 현재 진행 중
✅ 보수적 설정으로 5,000,000 타임스텝 훈련
⏳ 예상 완료: ~6시간 후

### 완료 후 계획
1. **테스트 세트 평가** - 미지의 데이터로 실제 성능 확인
2. **백테스팅** - 상세한 거래 분석
3. **실시간 모의 거래** - 테스트넷 dry-run
4. (옵션) 더 많은 데이터로 재훈련

---

## ⚠️ 중요 참고사항

### 현재 모델 한계
- 데이터: 60일 (이상적으로는 6개월~1년 필요)
- 검증 성능: +0.59% (실제 테스트 시 더 낮을 수 있음)
- 과적합 우려: 검증 vs 훈련 성능 차이 큼

### 실거래 주의사항
⚠️ **절대 실거래 금지**
- 현재 모델은 교육/테스트 목적
- 테스트넷에서만 사용
- 충분한 검증 후에만 소액 실거래 고려

---

## 📂 저장된 모델

| 모델 | 설정 | 데이터 | 검증 성능 | 상태 |
|------|------|--------|-----------|------|
| final_model.zip | 10x, V1 | 1000 | ~0% | 사용 안함 |
| best_model | 10x, V2 | 3997 | -0.57% | 사용 안함 |
| final_model_v3 | 10x, V3 | 3997 | -0.31% | 사용 안함 |
| **best_model (진행중)** | **3x, V3** | **17280** | **+0.59%** | ⭐ **최고** |

**최고 체크포인트**: 80k 타임스텝 (검증 +58.87)

---

## 🚀 시스템 구성 요약

### 완성된 컴포넌트
- ✅ BingX API 클라이언트 (테스트넷/메인넷)
- ✅ 데이터 수집 (CCXT, 최대 17,280 캔들)
- ✅ 기술적 지표 (EMA, RSI, BB, MACD, Stochastic, ADX, ATR, VWAP)
- ✅ 전처리 파이프라인
- ✅ Gymnasium 환경 V3 (순수 PnL 보상)
- ✅ PPO 에이전트 (Stable-Baselines3)
- ✅ 백테스팅 엔진
- ✅ 리스크 관리 시스템
- ✅ 실시간 거래 모듈 (모의/실거래)

### 실행 스크립트
- ✅ `collect_public_data.py` - 최대 데이터 수집
- ✅ `train_conservative.py` - 보수적 훈련 ⭐
- ✅ `quick_eval.py` - 빠른 모델 평가
- ✅ `backtest.py` - 백테스팅
- ✅ `live_trade.py` - 실시간 거래

---

**현재 상태**: 🟢 훈련 진행 중 (정상)
