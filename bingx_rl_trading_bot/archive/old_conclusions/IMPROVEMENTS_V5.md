# V5 환경 개선사항

## 🔍 V4의 문제점 분석

### 발견된 문제

**1. 과도한 거래 빈도 (98.2%)**
```
문제: 2,539회 ÷ 2,585 스텝 = 거의 매 스텝 거래
원인: 거래 빈도 페널티(-5)가 너무 약함
결과: 수수료 잠식
```

**2. 극히 낮은 승률 (0.55%)**
```
문제: 14승 / 2,525패
원인: 손절 1%가 너무 빠름 (레버리지 3배 = 0.33% 움직임)
결과: 정상 변동도 손절
```

**3. 홀딩 보너스 왜곡**
```
문제: 보상 +5,140 vs 실제 -0.04%
원인: 홀딩 보너스가 보상 지배
결과: 모델이 잘못된 목표 학습
```

---

## ✅ V5 핵심 개선사항

### 개선 1: 홀딩 보너스 완전 제거
```python
# V4 (기존)
reward = portfolio_return × 10000 + holding_bonus + penalties

# V5 (개선)
reward = portfolio_return × 10000 + penalties (only)

효과:
- 보상 = 실제 수익률 정확히 반영
- 왜곡 제거
```

### 개선 2: 거래 빈도 페널티 강화 (20배)
```python
# V4
if hold < 3 steps: penalty = -5

# V5
if hold < 10 steps: penalty = -100

효과:
- 강력한 거래 억제
- 수수료 절감
```

### 개선 3: 손절/익절 완화
```python
# V4
stop_loss: 1%, take_profit: 2%

# V5
stop_loss: 2%, take_profit: 3%

효과:
- 정상 변동 허용
- 승률 개선 기대
```

### 개선 4: 최소 홀딩 기간 증가
```python
# V4: min_hold_steps = 3
# V5: min_hold_steps = 10

효과:
- 거래 빈도 자연스럽게 감소
- 장기 트렌드 포착
```

---

## 📊 예상 효과

### V4 → V5 예상 개선

| 지표 | V4 | V5 예상 | 개선 |
|------|-----|---------|------|
| 테스트 수익률 | -0.04% | **+0.2~0.5%** | 수익 전환! |
| 거래 횟수 | 2,539 | **250~500** | 80% 감소 |
| 승률 | 0.55% | **5~15%** | 10배+ 개선 |
| 보상 왜곡 | 심각 | **없음** | 해결 |

---

## 🚀 빠른 테스트 (진행 중)

**설정**:
- 타임스텝: 500,000 (빠른 검증)
- 예상 소요: 10-15분
- 프로세스: a3a0a1

**검증 항목**:
1. ✓ 거래 빈도 감소하는가?
2. ✓ 승률 개선되는가?
3. ✓ 보상 = 실제 수익률인가?
4. ✓ 수익 전환 가능한가?

---

## 📝 전체 버전 히스토리

| 버전 | 핵심 특징 | 테스트 수익률 | 주요 문제 |
|------|-----------|---------------|-----------|
| V1 | 기본 | -0.02% | 5개 버그 |
| V2 | 버그 수정 | -0.57% | 과적합 |
| V3 | 순수 PnL | -0.31% | 과적합 |
| V4 | K-Fold + 시장체제 | -0.04% | 홀딩 보너스 왜곡 |
| **V5** | **순수 PnL + 강력 제약** | **테스트 중** | **-** |

---

## 🎯 목표

**V5 목표**:
- 테스트 수익률: **+0.3% 이상**
- 승률: **10% 이상**
- 거래 횟수: **500회 이하**
- 보상 왜곡: **없음**

**달성 시**:
- 손익분기 돌파
- 소액 실거래 고려 가능
- 프로젝트 성공

---

**작성**: 2025-10-07
**상태**: V5 빠른 테스트 진행 중
