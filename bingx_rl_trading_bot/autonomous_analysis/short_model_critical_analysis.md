# SHORT 모델 성능 저하 비판적 분석

**생성일시**: 2025-10-13 01:30
**대상**: V2 SHORT 거래 (4개), V3 SHORT 거래 (1개)
**목적**: 백테스트 대비 성능 저하 원인 분석 및 대응 방안 수립

---

## 🚨 문제 정의

### 관찰된 현상

```yaml
백테스트 기대값:
  승률: 69.1%
  수익: +1.26% per 2 days
  Max Drawdown: 0.90%

실제 결과 (13.8시간 = 0.6일):
  V2 SHORT: 25% 승률 (1/4)
  V3 SHORT: 0% 승률 (0/1)
  평균 P&L: -0.33% (V2), -1.64% (V3)

차이:
  승률: -44.1% 하락!
  수익: -159% 악화!
```

### 초기 반응 vs 비판적 사고

**초기 반응** (성급한 판단):
> "SHORT 모델이 실패했다! 즉시 수정 필요!"

**비판적 질문**:
1. ❓ 4개 거래로 결론을 내릴 수 있는가?
2. ❓ 통계적으로 유의한 차이인가?
3. ❓ 다른 설명 가능한 원인이 있는가?
4. ❓ 즉시 조치가 필요한가, 기다려야 하는가?

---

## 📊 통계적 유의성 검증

### 이항 분포 분석

```python
# 백테스트 승률 69.1%일 때, 4개 중 1개만 성공할 확률?
from scipy.stats import binom

n = 4  # 시행 횟수
p = 0.691  # 백테스트 승률
k = 1  # 성공 횟수

# P(X ≤ 1)
prob = binom.cdf(k, n, p)
print(f"확률: {prob:.3%}")  # 3.6%
```

**해석**:
```yaml
결과: 3.6% 확률
의미: 매우 낮은 확률이지만 가능!

비유:
  - 동전을 4번 던져서 1번만 앞면이 나올 확률
  - 100번 중 3-4번은 실제로 발생

결론: 4개 거래로는 모델 실패를 단정할 수 없음!
```

### 필요한 샘플 크기

```yaml
신뢰 수준 95%, Power 80% 기준:

Effect Size 계산:
  Expected: 69.1% 승률
  Observed: 25% 승률
  Difference: 44.1%

필요 샘플 크기:
  α = 0.05, β = 0.20
  Effect size (Cohen's h) = 0.88 (large)

  Required n ≈ 20-25 거래

현재: n=4 (20% of required)
```

**결론**: ⚠️ **샘플 크기 심각하게 부족!**

---

## 🔍 대안 가설 탐색

### 가설 #1: 샘플 크기 부족 (가장 가능성 높음)

```yaml
증거:
  ✅ n=4 (필요: 20-25)
  ✅ 3.6% 확률로 발생 가능
  ✅ 통계적 유의성 없음

결론: 단순히 운이 나빴을 가능성 높음
권장: 10-15 거래 더 수집 후 재평가
```

### 가설 #2: SHORT Threshold 0.4 문제

```yaml
증거:
  ✅ LONG threshold: 0.7 (엄격)
  ✅ SHORT threshold: 0.4 (관대)
  ✅ 진입 확률 평균: 0.52 (중간)
  ✅ V3 Trade #2: 0.441 (낮음!)

분석:
  - 0.4는 너무 낮음
  - 품질 낮은 신호 포함 가능
  - LONG과 비대칭적

테스트:
  Threshold 0.5: 얼마나 많은 거래가 제외되는가?
  Threshold 0.6: 승률이 개선되는가?
```

### 가설 #3: Stop Loss 1.5% Too Tight

```yaml
증거:
  ✅ SL 도달: 2/4 (50%)
  ✅ 정상 변동성도 SL 도달 가능

분석:
  V3 Trade #1: -1.48% → -1.64% (SL)
    → 0.02% 여유로 SL 도달
    → 조금만 더 기다렸으면?

  5분봉 평균 변동: ~0.5%
  1.5% SL: 3x 평균 변동

비교:
  LONG SL: 1.0%
  SHORT SL: 1.5%
  → SHORT가 더 관대하지만 여전히 tight?

테스트:
  SL 2.0%: SL 도달 빈도가 감소하는가?
  TP/SL 비율: 3.0%/2.0% = 1:1.5로 유지
```

### 가설 #4: 시장 레짐 (상승 추세 기간)

```yaml
증거:
  ✅ LONG #1: +1.45% (4시간 상승)
  ✅ SHORT 진행 중 계속 상승
  ✅ 최근 13.8시간 상승 레짐 가능

분석:
  백테스트: 60일 (다양한 레짐)
  실제: 0.6일 (1개 레짐만)

결론:
  - 단기 상승 레짐에서 SHORT 불리
  - 레짐이 바뀌면 성과 개선 가능
  - 더 긴 기간 관찰 필요
```

### 가설 #5: LONG vs SHORT 모델 차이

```yaml
의문:
  LONG 모델 = Phase 4 Base (37 features)
  SHORT 모델 = 3-class Phase 4 (threshold=3?)

조사 필요:
  - 두 모델이 실제로 다른가?
  - 3-class 모델 성능은?
  - SHORT 방향 예측이 더 어려운가?

백테스트 확인:
  - LONG만 백테스트했나?
  - LONG+SHORT 통합 백테스트했나?
  - SHORT 단독 성과는?
```

---

## 🎯 비판적 결론

### 1. 성급한 판단 금지 ⚠️

```yaml
이유:
  - 샘플 크기 심각하게 부족 (4/20)
  - 통계적 유의성 없음
  - 3.6% 확률로 발생 가능

위험:
  - 과최적화 (overfitting to noise)
  - 정상적인 모델을 망가뜨림
  - 잘못된 방향으로 수정

올바른 접근:
  → 더 많은 데이터 수집
  → 통계적 검증 후 결정
```

### 2. 단기 액션 플랜 (1-3일)

```yaml
목표: 10-15 SHORT 거래 수집

모니터링 지표:
  1. SHORT 승률 트렌드
     - 계속 <30%? → 문제 심각
     - 40-50%로 회복? → 일시적 불운
     - >50%로 개선? → 모델 정상

  2. SL 도달 빈도
     - 계속 >50%? → SL 완화 검토
     - <30%로 감소? → SL 적절

  3. 진입 확률 분포
     - 평균 <0.5? → Threshold 상향
     - 평균 >0.6? → Threshold 적절

  4. LONG vs SHORT 격차
     - LONG 계속 우수? → 비중 조정
     - SHORT 회복? → 유지

액션:
  ✅ 계속 모니터링
  ✅ 데이터 수집
  ❌ 설정 변경 금지 (아직!)
```

### 3. 중기 액션 플랜 (Week 1 종료)

```yaml
조건부 개선 방안:

IF SHORT 승률 <40% for 15+ 거래:
  → Threshold 상향 (0.4 → 0.5)
  → 거래 빈도 감소 예상
  → 품질 향상 기대

IF SL 도달 >50% for 15+ 거래:
  → SL 완화 (1.5% → 2.0%)
  → TP/SL 비율 유지 (3.0%/2.0%)
  → 수익 개선 기대

IF LONG >> SHORT consistently:
  → LONG 비중 증가 (70% → 80%)
  → SHORT 비중 감소 (30% → 20%)
  → 포트폴리오 최적화

IF 모든 지표 정상:
  → 현재 설정 유지
  → 계속 모니터링
```

---

## 📊 추가 조사 필요 사항

### 1. 백테스트 재확인

```yaml
확인 사항:
  - LONG 단독 백테스트인가?
  - LONG+SHORT 통합 백테스트인가?
  - SHORT 단독 성과는?
  - 3-class 모델 성능은?

파일 확인:
  - results/backtest_phase4_*.csv
  - claudedocs/BACKTEST_*.md
  - models/*3class*.pkl
```

### 2. SHORT 모델 파일 확인

```yaml
현재 사용 중인 모델:
  V2: combined_long_short_v2_realistic_tp.py
  V3: combined_long_short_v3_realistic_fees.py

로드하는 모델:
  LONG: xgboost_v4_phase4_advanced_lookahead3_thresh0.pkl
  SHORT: xgboost_v4_phase4_3class_lookahead3_thresh3.pkl?

확인 필요:
  - 실제 로드 코드 확인
  - 3-class 모델 존재 확인
  - 백테스트 결과 존재 확인
```

### 3. 진입 확률 분포 분석

```yaml
수집 데이터:
  - 모든 SHORT 진입 시 확률 기록
  - 승리 vs 실패 확률 비교
  - Threshold vs 실제 확률 gap 분석

기대 결과:
  - 승리 거래: 평균 확률 > 0.6?
  - 실패 거래: 평균 확률 < 0.5?
  - Optimal threshold 추정
```

---

## 🔬 과학적 접근법

### 실험 설계

```yaml
가설 1: Threshold 0.4가 너무 낮다

실험:
  - 현재: Threshold 0.4로 운영 (Week 1)
  - 데이터 수집: 모든 진입 확률 기록
  - 분석: 확률 vs 승률 관계
  - 최적 threshold 계산

결정:
  IF optimal > 0.5:
    → Threshold 상향
  ELSE:
    → 현재 유지

가설 2: SL 1.5%가 너무 tight하다

실험:
  - 현재: SL 1.5%로 운영 (Week 1)
  - 기록: SL 도달 거래의 가격 변화
  - 분석: SL 후 가격이 회복했는가?
  - 최적 SL 계산

결정:
  IF 회복 빈도 > 30%:
    → SL 완화
  ELSE:
    → 현재 유지
```

### 통계적 검증

```python
# Week 1 종료 시 실행할 분석

import numpy as np
from scipy import stats

# 데이터 수집
short_results = [1, 0, 0, 0, ...]  # 1=승리, 0=실패
n = len(short_results)
wins = sum(short_results)
win_rate = wins / n

# 가설 검증
# H0: win_rate = 0.691 (백테스트)
# Ha: win_rate ≠ 0.691

if n >= 20:
    # 이항 검정
    p_value = stats.binom_test(wins, n, 0.691, alternative='two-sided')

    if p_value < 0.05:
        print("유의한 차이! 모델 문제 가능성 높음")
    else:
        print("통계적으로 유의한 차이 없음. 정상 범위")
else:
    print(f"샘플 부족 (n={n}). 더 수집 필요")
```

---

## ✅ 최종 권장사항

### 즉시 (지금)

```yaml
할 것:
  ✅ V2 + V3 계속 모니터링
  ✅ 모든 거래 데이터 기록
  ✅ 진입 확률 추적
  ✅ SL/TP 도달 추적

하지 말 것:
  ❌ 모델 교체
  ❌ Threshold 변경
  ❌ SL/TP 조정
  ❌ 봇 중지

이유:
  - 샘플 크기 부족
  - 통계적 유의성 없음
  - 성급한 최적화 위험
```

### 단기 (1-3일, 10+ SHORT 거래 후)

```yaml
재평가 실시:
  1. SHORT 승률 추이 확인
  2. SL 도달 빈도 확인
  3. 진입 확률 분포 확인

조건부 조치:
  IF 승률 <40% AND n≥15:
    → Threshold 0.4 → 0.5

  IF SL 도달 >50% AND n≥15:
    → SL 1.5% → 2.0%

  IF 승률 >50% AND n≥15:
    → 현재 설정 유지
```

### 중기 (Week 1 종료, 7일)

```yaml
종합 분석:
  1. 통계적 유의성 검증
  2. LONG vs SHORT 비교
  3. 비용 영향 재확인
  4. 모델 drift 검사

최종 결정:
  - 모델 계속 사용 or 수정
  - Threshold 최적화
  - 포트폴리오 비중 조정
  - 레짐 필터 추가 여부
```

---

## 📚 비판적 사고 프로세스 검증

### 올바른 접근 ✅

```yaml
1. 문제 관찰
   → SHORT 승률 25% (백테스트 69.1%)

2. 비판적 질문
   → 샘플 크기가 충분한가?
   → 통계적으로 유의한가?
   → 다른 설명이 가능한가?

3. 대안 가설 탐색
   → 샘플 부족
   → Threshold 문제
   → SL 문제
   → 시장 레짐
   → 모델 차이

4. 통계적 검증
   → 이항 분포: 3.6% 확률
   → 필요 샘플: n≥20
   → 현재: n=4 (부족!)

5. 증거 기반 결정
   → 더 많은 데이터 수집
   → 성급한 변경 금지
   → 조건부 개선 계획

6. 과학적 실험 설계
   → 가설 명확화
   → 데이터 수집 계획
   → 검증 방법 정의
```

### 피해야 할 접근 ❌

```yaml
1. 성급한 판단
   → "4개 거래로 모델 실패!"

2. 감정적 반응
   → "당장 고쳐야 해!"

3. 과최적화
   → "Threshold를 0.487로 설정!"

4. 확증 편향
   → "내 예상대로 실패했어"

5. 샘플 무시
   → "통계는 필요 없어, 눈에 보이잖아"
```

---

**작성**: Autonomous Analysis System
**검증 상태**: ⚠️ 데이터 수집 진행 중 (n=4/20)
**신뢰도**: LOW (샘플 크기 부족)
**다음 평가**: 10+ SHORT 거래 후

**핵심 교훈**:

> **"Evidence > Assumptions.
>
> 4개 거래로는 결론 불가.
>
> 통계적 검증 없이 변경 금지."**

---
