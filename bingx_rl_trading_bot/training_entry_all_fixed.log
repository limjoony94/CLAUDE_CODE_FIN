================================================================================
COMPLETE 4-MODEL TRAINING: ENHANCED FEATURES
================================================================================

Configuration:
  Phase: phase1
  Entry Threshold (LONG/SHORT): 0.65/0.7
  ML Exit Threshold (LONG/SHORT): 0.75/0.75
  Stop Loss: -3.0%
  Max Hold: 120 candles

================================================================================
STEP 1: Loading Data and Calculating Enhanced Features
================================================================================

âœ… Loaded 32,841 candles
   Date range: 2025-07-01 14:00:00 to 2025-10-23 14:40:00

Calculating enhanced features (phase1)...
================================================================================
ENHANCED FEATURE CALCULATION V2
================================================================================

Step 1/4: Calculating baseline features (LONG + SHORT)...
Calculating ALL features (LONG + SHORT)...
  1/4 Calculating LONG basic features...
  2/4 Calculating LONG advanced features...
  3/4 Calculating SHORT features...
  4/4 Cleaning NaN values...
  âœ… All features calculated (32841 rows)
  âœ… Baseline: 107 features

Step 2/4: Calculating long-term features (200-period)...
  âœ… Long-term: 23 features

Step 3/4: Calculating advanced indicators (phase1)...
  [1/3] Calculating Volume Profile (7 features)...
  [2/3] Calculating VWAP (4 features)...

âœ… Advanced indicators calculated:
   - Volume Profile: 7 features
   - VWAP: 4 features
   - Total: 11 features
   - Rows: 32,841 â†’ 32,554 (lost 287 due to lookback)
  âœ… Advanced: 11 features (VP 7 + VWAP 4)

Step 4/4: Calculating engineered ratio features...
  âœ… Ratios: 24 features

Cleaning NaN values...

================================================================================
FEATURE CALCULATION COMPLETE
================================================================================

âœ… Total features: 165
   - Baseline: 107
   - Long-term: 23
   - Advanced: 11 (VP + VWAP)
   - Engineered ratios: 24

âœ… Data coverage: 32,549 / 32,841 rows
   Lost 292 rows due to lookback periods


Calculating enhanced market context features...
âœ… Enhanced features calculated

âœ… Enhanced features calculated (including Exit-specific features)
   Total columns: 193
   Final rows: 32,549

================================================================================
STEP 2: Loading Production Entry Models
================================================================================

âœ… Production Entry models loaded
   LONG Entry features: 44
   SHORT Entry features: 38

================================================================================
STEP 3: Preparing Enhanced Feature Sets
================================================================================

ðŸ” DEBUG: Exit Feature Filtering
   Total candidates: 47
   Filtered features: 47

âœ… Feature sets prepared:
   LONG Entry: 85 features
   SHORT Entry: 79 features
   Exit (filtered): 47 features (from 47 candidates)
   SHORT Exit: 47 features

================================================================================
STEP 4: Training EXIT Models (LONG + SHORT)
================================================================================

Why Exit first?
  - Entry models need Trade-Outcome labels
  - Trade-Outcome labels need Exit model for criterion 4 (efficient exit)
  - So Exit models must be trained first

================================================================================
STEP 4: Loading Pre-trained EXIT Models (timestamp: 20251023_212712)
================================================================================
âœ… LONG Exit: 47 features
âœ… SHORT Exit: 47 features

================================================================================
STEP 5: Training ENTRY Models (LONG + SHORT)
================================================================================

Why Entry second?
  - Entry labels use Trade-Outcome Labeling
  - Trade-Outcome criterion 4 needs Exit model (efficient exit)
  - So we use the newly trained Exit models above

--------------------------------------------------------------------------------
5.1: Training LONG Entry Model
--------------------------------------------------------------------------------

Creating LONG entry labels with Trade-Outcome...

LONG Entry Labeling (Trade-Outcome Based)
  Simulating 32,419 potential entries...
  Progress: 5,000/32,419 (15.4%)
  Progress: 10,000/32,419 (30.8%)
  Progress: 15,000/32,419 (46.3%)
  Progress: 20,000/32,419 (61.7%)
  Progress: 25,000/32,419 (77.1%)
  Progress: 30,000/32,419 (92.5%)

  LONG Entry Label Statistics:
  Total Candles Evaluated: 32,419

  Criterion Met Rates:
    1. Profitable (>=2.0%):  6,414 (19.8%)
    2. Good Risk-Reward (MAE<2.0%, MFE>4.0%): 2,781 (8.6%)
    3. Efficient Exit (ML Exit):     17,334 (53.5%)

  Score Distribution:
    Score 0 (0/3): 13,562 (41.8%)
    Score 1 (1/3): 12,981 (40.0%)
    Score 2 (2/3): 4,080 (12.6%) (labeled positive)
    Score 3 (3/3): 1,796 (5.5%) (labeled positive)

  Positive Label Rate: 5,876/32,549 (18.1%)
  âœ… LONG Entry labels created

âœ… Created 32549 LONG entry labels
   Positive rate: 18.05%

Training LONG Entry model (full data + 5-fold CV)...
  Total samples: 32,549
Running 5-fold time series cross-validation...
CV Precision: 0.2729 Â± 0.0717
Folds: 0.1505, 0.2510, 0.2811, 0.3205, 0.3616

Training final model on all data...

âœ… LONG Entry Model Performance (training):
              precision    recall  f1-score   support

           0     0.9959    0.9523    0.9736     26673
           1     0.8193    0.9823    0.8934      5876

    accuracy                         0.9577     32549
   macro avg     0.9076    0.9673    0.9335     32549
weighted avg     0.9640    0.9577    0.9591     32549

ROC-AUC: 0.9960

Top 10 Features (LONG Entry):
  bb_low                         0.0601
  vp_value_area_low              0.0482
  distance_from_recent_high_pct  0.0378
  vwap                           0.0351
  vp_poc                         0.0348
  vp_value_area_high             0.0303
  vp_efficiency                  0.0293
  ema_200                        0.0263
  ma_200                         0.0261
  atr_200                        0.0260

âœ… LONG Entry model saved:
   xgboost_long_entry_enhanced_20251024_012445.pkl

--------------------------------------------------------------------------------
5.2: Training SHORT Entry Model
--------------------------------------------------------------------------------

Creating SHORT entry labels with Trade-Outcome...

SHORT Entry Labeling (Trade-Outcome Based)
  Simulating 32,419 potential entries...
  Progress: 5,000/32,419 (15.4%)
  Progress: 10,000/32,419 (30.8%)
  Progress: 15,000/32,419 (46.3%)
  Progress: 20,000/32,419 (61.7%)
  Progress: 25,000/32,419 (77.1%)
  Progress: 30,000/32,419 (92.5%)

  SHORT Entry Label Statistics:
  Total Candles Evaluated: 32,419

  Criterion Met Rates:
    1. Profitable (>=2.0%):  8,075 (24.9%)
    2. Good Risk-Reward (MAE<2.0%, MFE>4.0%): 4,221 (13.0%)
    3. Efficient Exit (ML Exit):     14,739 (45.5%)

  Score Distribution:
    Score 0 (0/3): 15,277 (47.1%)
    Score 1 (1/3): 10,022 (30.9%)
    Score 2 (2/3): 4,347 (13.4%) (labeled positive)
    Score 3 (3/3): 2,773 (8.6%) (labeled positive)

  Positive Label Rate: 7,120/32,549 (21.9%)
  âœ… SHORT Entry labels created

âœ… Created 32549 SHORT entry labels
   Positive rate: 21.87%

Training SHORT Entry model (full data + 5-fold CV)...
  Total samples: 32,549
Running 5-fold time series cross-validation...
CV Precision: 0.2937 Â± 0.1098
Folds: 0.4384, 0.3209, 0.1727, 0.1618, 0.3749

Training final model on all data...

âœ… SHORT Entry Model Performance (training):
              precision    recall  f1-score   support

           0     0.9938    0.9500    0.9714     25429
           1     0.8458    0.9788    0.9074      7120

    accuracy                         0.9563     32549
   macro avg     0.9198    0.9644    0.9394     32549
weighted avg     0.9614    0.9563    0.9574     32549

ROC-AUC: 0.9947

Top 10 Features (SHORT Entry):
  atr_pct                        0.0642
  vp_value_area_high             0.0327
  vwap                           0.0307
  institutional_activity_zone    0.0299
  ema_12                         0.0289
  vp_poc                         0.0288
  vp_value_area_low              0.0287
  vwap_near_vp_support           0.0264
  atr_200                        0.0262
  ma_200                         0.0260

âœ… SHORT Entry model saved:
   xgboost_short_entry_enhanced_20251024_012445.pkl

================================================================================
TRAINING COMPLETE - ENTRY MODELS ONLY
================================================================================

ðŸ“Š Models Saved (timestamp: 20251024_012445):

1. LONG Entry:
   xgboost_long_entry_enhanced_20251024_012445.pkl
   Features: 85
   Samples: 32,549
   Positive Rate: 18.05%

2. SHORT Entry:
   xgboost_short_entry_enhanced_20251024_012445.pkl
   Features: 79
   Samples: 32,549
   Positive Rate: 21.87%

âœ… Entry models trained with enhanced features (165 total):
   - Baseline: 107 features
   - Long-term: 4 features (ma_200, ema_200, rsi_200, atr_200)
   - Advanced: 11 features (VP + VWAP)
   - Ratios: 24 features (engineered)

ðŸ“¦ Pre-trained Exit models loaded (timestamp: 20251023_212712):
   - LONG Exit: xgboost_long_exit_enhanced_20251023_212712.pkl
   - SHORT Exit: xgboost_short_exit_enhanced_20251023_212712.pkl

ðŸŽ¯ Next Steps:
   1. Backtest validation with new Entry models
   2. Performance comparison vs production models
   3. Deploy if improvement confirmed

================================================================================
